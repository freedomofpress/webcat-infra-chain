syntax = "proto3";

package felidae.transaction;

message Config {
    message VotingConfig {
        int64 total = 1;
        int64 quorum = 2;
        int64 timeout = 3;
        int64 delay = 4;
    }

    message AdminConfig {
        repeated Admin admins = 1;
        VotingConfig voting_config = 2;
    }

    message OracleConfig {
        repeated Oracle oracles = 1;
        VotingConfig voting_config = 2;
        bool enabled = 3;
        int64 max_enrolled_subdomains = 4;
        int64 observation_timeout = 5;
    }

    message OnionConfig {
        bool enabled = 1;
    }

    AdminConfig admin_config = 1;
    OracleConfig oracle_config = 2;
    OnionConfig onion_config = 3;
    int64 version = 4;
}

message Oracle {
    bytes public_key = 1;
}

message Admin {
    bytes public_key = 1;
}

message Signature {
    bytes public_key = 1;
    bytes signature = 2;
}

message Transaction {
    string chain_id = 1;
    repeated Action actions = 2;
}

message Timestamp {
    int64 seconds = 1;
    int32 nanos = 2;
}

message Action {
    oneof action {
        Reconfigure reconfigure = 1;
        Observe observe = 2;
    }

    message Reconfigure {
        Signature signature = 1;
        Config config = 2;
        Timestamp not_before = 3;
        Timestamp not_after = 4;
    }

    message Observe {
        message Observation {
            message Blockstamp {
                bytes block_hash = 1;
                int64 block_number = 2;
            }
            message HashObserved {
                bytes hash = 1;
            }
            string domain = 1;
            string zone = 2;
            HashObserved hash_observed = 3;
            Blockstamp blockstamp = 4;
        }

        Signature signature = 1;
        Observation observation = 2;
    }
}